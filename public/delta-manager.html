<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deltaç®¡ç†å™¨ - DeribitæœŸæƒäº¤æ˜“</title>
    <link rel="stylesheet" href="/tiger_static/css/dashboard.css">
    <link rel="icon" type="image/x-icon" href="/tiger_static/favicon.ico">
    <style>
        /* Delta Manager specific styles extending dashboard.css */

        .delta-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .delta-header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .delta-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .delta-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .account-selector {
            text-align: center;
            margin-bottom: 30px;
        }

        .account-selector select {
            padding: 12px 20px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            background: white;
            color: #2d3748;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
        }

        .account-selector select:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
        }

        .stats-section {
            background: white;
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 40px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            color: white;
            padding: 24px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(66, 153, 225, 0.3);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(66, 153, 225, 0.4);
        }

        .stat-card h3 {
            font-size: 1rem;
            margin-bottom: 12px;
            opacity: 0.9;
            font-weight: 500;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .stat-subtitle {
            font-size: 0.9rem;
            opacity: 0.8;
            font-style: italic;
        }

        .section {
            background: white;
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 40px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 1.5rem;
            color: #2d3748;
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 3px solid #4299e1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .table-container {
            background: #f7fafc;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0,0,0,0.05);
            border: 1px solid rgba(255,255,255,0.2);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            color: white;
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            border: none;
        }

        td {
            padding: 14px 12px;
            border-bottom: 1px solid #e2e8f0;
            color: #4a5568;
            font-size: 0.9rem;
        }

        tr:hover {
            background-color: #f1f5f9;
        }

        tr:last-child td {
            border-bottom: none;
        }

        .btn-group {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .btn-sm:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn-view {
            background-color: #38b2ac;
            color: white;
        }

        .btn-edit {
            background-color: #4299e1;
            color: white;
        }

        .btn-delete {
            background-color: #f56565;
            color: white;
        }

        .btn-add {
            background-color: #48bb78;
            color: white;
        }

        .btn-refresh-delta {
            background-color: #805ad5;
            color: white;
            font-size: 0.75rem;
            padding: 4px 8px;
            margin-left: 5px;
        }

        .btn-refresh-delta:hover {
            background-color: #6b46c1;
        }

        .delta-cell-wrapper {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 32px;
            border: none;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .close {
            color: #a0aec0;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
            transition: color 0.2s ease;
        }

        .close:hover,
        .close:focus {
            color: #f56565;
            text-decoration: none;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.2s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }
        }

        .delta-positive {
            color: #48bb78;
            font-weight: bold;
        }

        .delta-negative {
            color: #f56565;
            font-weight: bold;
        }

        .pnl-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 72px;
            padding: 4px 10px;
            border-radius: 999px;
            font-weight: 600;
            font-size: 0.85rem;
            letter-spacing: 0.01em;
        }

        .pnl-positive {
            color: #0f9d58;
            background: rgba(15, 157, 88, 0.14);
        }

        .pnl-negative {
            color: #d93025;
            background: rgba(217, 48, 37, 0.18);
        }

        .pnl-neutral {
            color: #4a5568;
            background: rgba(74, 85, 104, 0.14);
        }

        .delta-loading {
            color: #4299e1;
            font-style: italic;
            animation: pulse 1.5s ease-in-out infinite alternate;
        }

        @keyframes pulse {
            from { opacity: 0.6; }
            to { opacity: 1; }
        }

        .action-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .action-buy {
            background: #48bb78;
            color: white;
        }

        .action-sell {
            background: #f56565;
            color: white;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
            font-style: italic;
        }

        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 16px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #f56565;
        }

        .success {
            background: #c6f6d5;
            color: #2f855a;
            padding: 16px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #48bb78;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #718096;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .empty-state-subtext {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Navigation */
        .nav-breadcrumb {
            margin-bottom: 20px;
        }

        .nav-breadcrumb a {
            color: white;
            text-decoration: none;
            opacity: 0.8;
            transition: opacity 0.2s ease;
        }

        .nav-breadcrumb a:hover {
            opacity: 1;
            text-decoration: underline;
        }

        .nav-breadcrumb span {
            color: white;
            margin: 0 8px;
            opacity: 0.6;
        }

        .status-valid {
            color: #48bb78;
            font-weight: bold;
        }

        .status-invalid {
            color: #f56565;
            font-weight: bold;
            cursor: help;
        }

        .status-unknown {
            color: #ed8936;
            font-weight: bold;
        }

        .status-normal {
            color: #48bb78;
            font-weight: bold;
            font-size: 12px;
        }

        .status-abnormal {
            color: #f56565;
            font-weight: bold;
            font-size: 12px;
        }

        /* è­¦æŠ¥æ¶ˆæ¯å¼¹çª—æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow: hidden;
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.2rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .modal-close:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-body p {
            margin: 0 0 15px 0;
            color: #666;
        }

        #alertMessageText {
            width: 100%;
            height: 200px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
            resize: vertical;
            background-color: #f8f9fa;
            margin-bottom: 20px;
            box-sizing: border-box;
        }

        #alertMessageText:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .invalid-record {
            background-color: #fed7d7;
            border-left: 4px solid #f56565;
        }

        .invalid-record:hover {
            background-color: #fbb6ce;
        }

        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #4299e1;
            color: white;
            border: none;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(66, 153, 225, 0.4);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .refresh-btn:hover {
            transform: scale(1.1);
            background: #3182ce;
            box-shadow: 0 12px 35px rgba(66, 153, 225, 0.5);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .delta-container {
                padding: 16px;
            }

            .delta-header h1 {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .section {
                padding: 24px;
            }

            table {
                font-size: 0.8rem;
            }

            th, td {
                padding: 10px 8px;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn-sm {
                width: 100%;
                margin-bottom: 4px;
            }
        }
    </style>
</head>
<body>
    <div class="delta-container">
        <header class="delta-header">
            <div class="nav-breadcrumb">
                <a href="/">ğŸ  é¦–é¡µ</a>
                <span>/</span>
                <span>Deltaç®¡ç†å™¨</span>
            </div>
            <h1>ğŸ“Š Deltaç®¡ç†å™¨</h1>
            <p class="delta-subtitle">DeribitæœŸæƒä»“ä½å’Œè®¢å•Deltaç®¡ç†</p>

            <div class="account-selector">
                <select id="accountSelect">
                    <option value="">è¯·é€‰æ‹©è´¦æˆ·...</option>
                </select>
                <button class="btn btn-primary" onclick="copyAlertMessage()" style="margin-left: 10px;">
                    ğŸ“‹ å¤åˆ¶è­¦æŠ¥æ¶ˆæ¯
                </button>
            </div>
        </header>

        <div id="loadingMessage" class="loading">
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ”„</div>
                <div class="empty-state-text">æ­£åœ¨åŠ è½½æ•°æ®...</div>
                <div class="empty-state-subtext">è¯·ç¨å€™ï¼Œæ­£åœ¨è·å–æœ€æ–°çš„Deltaæ•°æ®</div>
            </div>
        </div>

        <div id="errorMessage" class="error" style="display: none;"></div>
        <div id="successMessage" class="success" style="display: none;"></div>

        <div id="mainContent" style="display: none;">
            <!-- ç»Ÿè®¡ä¿¡æ¯ -->
            <div class="stats-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>æ€»è®°å½•æ•°</h3>
                        <div class="value" id="totalRecords">0</div>
                        <div class="stat-subtitle">æ•°æ®åº“è®°å½•æ€»æ•°</div>
                    </div>
                    <div class="stat-card">
                        <h3>ä»“ä½è®°å½•</h3>
                        <div class="value" id="positionRecords">0</div>
                        <div class="stat-subtitle">Position Records</div>
                    </div>
                    <div class="stat-card">
                        <h3>è®¢å•è®°å½•</h3>
                        <div class="value" id="orderRecords">0</div>
                        <div class="stat-subtitle">Order Records</div>
                    </div>
                    <div class="stat-card">
                        <h3>è´¦æˆ·æ±‡æ€»</h3>
                        <div class="value" id="accountSummary">0</div>
                        <div class="stat-subtitle">Account Summary</div>
                    </div>
                </div>
            </div>

            <!-- æ•°æ®åº“ä¸­çš„ä»“ä½è®°å½• -->
            <div class="section">
                <div class="section-title">
                    ğŸ“Š æ•°æ®åº“ä»“ä½è®°å½•
                    <div>
                        <button class="btn btn-primary" onclick="refreshData()">
                            ğŸ”„ åˆ·æ–°æ‰€æœ‰
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="positionRecordsTable">
                        <thead>
                            <tr>
                                <th>çŠ¶æ€</th>
                                <th>åˆçº¦åç§°</th>
                                <th>æ•°é‡</th>
                                <th>ç›®æ ‡Delta(2)</th>
                                <th>ç§»ä»“Delta(1)</th>
                                <th>Delta</th>
                                <th>ç›ˆäºç‡</th>
                                <th>æœ€å°åˆ°æœŸå¤©æ•°</th>
                                <th>TV_ID</th>
                                <th>åŠ¨ä½œ</th>
                                <th>åˆ›å»ºæ—¶é—´</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- æ•°æ®åº“ä¸­çš„è®¢å•è®°å½• -->
            <div class="section">
                <div class="section-title">
                    ğŸ“‹ æ•°æ®åº“è®¢å•è®°å½•
                </div>
                <div class="table-container">
                    <table id="orderRecordsTable">
                        <thead>
                            <tr>
                                <th>çŠ¶æ€</th>
                                <th>è®¢å•ID</th>
                                <th>åˆçº¦åç§°</th>
                                <th>æ•°é‡</th>
                                <th>ç›®æ ‡Delta(2)</th>
                                <th>ç§»ä»“Delta(1)</th>
                                <th>æœ€å°åˆ°æœŸå¤©æ•°</th>
                                <th>TV_ID</th>
                                <th>åŠ¨ä½œ</th>
                                <th>æ›´æ–°æ—¶é—´</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- å®é™…ä»“ä½ -->
            <div class="section">
                <div class="section-title">
                    ğŸ¦ å®é™…ä»“ä½ (æ‰€æœ‰å“ç§æœŸæƒ)
                    <div>
                        <button class="btn btn-primary" onclick="refreshLiveData()">
                            ğŸ”„ åˆ·æ–°
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="positionsTable">
                        <thead>
                            <tr>
                                <th>åˆçº¦åç§°</th>
                                <th>æ•°é‡</th>
                                <th>æ–¹å‘</th>
                                    <th>å¹³å‡ä»·æ ¼</th>
                                    <th>æ ‡è®°ä»·æ ¼</th>
                                    <th>Delta</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <!-- æœªæˆäº¤è®¢å• -->
                <div class="section">
                    <div class="section-title">
                        ğŸ“‹ æœªæˆäº¤è®¢å• (æœªè®°å½•åœ¨æ•°æ®åº“ä¸­)
                    </div>
                    <div class="table-container">
                        <table id="ordersTable">
                            <thead>
                                <tr>
                                    <th>è®¢å•ID</th>
                                    <th>åˆçº¦åç§°</th>
                                    <th>æ–¹å‘</th>
                                    <th>æ•°é‡</th>
                                    <th>ä»·æ ¼</th>
                                    <th>ç±»å‹</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- åˆ·æ–°æŒ‰é’® -->
    <button class="refresh-btn" onclick="refreshData()" title="åˆ·æ–°æ•°æ®">
        ğŸ”„
    </button>

    <script>
        let currentAccount = '';
        let deltaRecords = [];
        let livePositions = [];
        let liveOrders = [];
        const DEFAULT_POSITIONS_CURRENCY = 'USD';
        let validatedRecords = [];

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            await loadAccounts();
            
            // ä»URLå‚æ•°è·å–è´¦æˆ·ID
            const urlParams = new URLSearchParams(window.location.search);
            const accountId = urlParams.get('account');
            if (accountId) {
                document.getElementById('accountSelect').value = accountId;
                selectAccount(accountId);
            }
        });

        // åŠ è½½è´¦æˆ·åˆ—è¡¨
        async function loadAccounts() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                
                const accounts = data.accounts || [];
                const select = document.getElementById('accountSelect');
                select.innerHTML = '<option value="">è¯·é€‰æ‹©è´¦æˆ·...</option>';
                
                accounts.forEach(account => {
                    const option = document.createElement('option');
                    option.value = account.name || account;
                    option.textContent = account.name || account;
                    select.appendChild(option);
                });
                
                select.addEventListener('change', function() {
                    if (this.value) {
                        selectAccount(this.value);
                        // æ›´æ–°URLå‚æ•°
                        const url = new URL(window.location);
                        url.searchParams.set('account', this.value);
                        window.history.pushState({}, '', url);
                    }
                });
                
            } catch (error) {
                showError('åŠ è½½è´¦æˆ·åˆ—è¡¨å¤±è´¥: ' + error.message);
            }
        }

        // é€‰æ‹©è´¦æˆ·
        function selectAccount(accountId) {
            currentAccount = accountId;
            loadData();
        }

        // åŠ è½½æ•°æ®
        async function loadData() {
            if (!currentAccount) {
                showError('è¯·å…ˆé€‰æ‹©è´¦æˆ·');
                return;
            }

            showLoading();

            try {
                // åŠ è½½Deltaè®°å½•
                const recordsResponse = await fetch(`/api/delta/records?account_id=${currentAccount}`);
                const recordsData = await recordsResponse.json();

                if (!recordsData.success) {
                    throw new Error(recordsData.message);
                }

                deltaRecords = recordsData.records || [];
                validatedRecords = deltaRecords; // ç®€åŒ–å¤„ç†

                // åŠ è½½å®æ—¶ä»“ä½å’Œè®¢å•æ•°æ®
                await loadLiveData();

                // åŠ è½½Deltaç»Ÿè®¡
                const statsResponse = await fetch('/api/delta/stats');
                const statsData = await statsResponse.json();

                // æ›´æ–°ç•Œé¢
                updateStats(recordsData, statsData.stats);
                await updatePositionRecordsTable();
                updateOrderRecordsTable();
                await updatePositionsTable();
                updateOrdersTable();

                hideLoading();
                showSuccess('æ•°æ®åŠ è½½æˆåŠŸ');

            } catch (error) {
                hideLoading();
                showError('åŠ è½½æ•°æ®å¤±è´¥: ' + error.message);
            }
        }

        // åŠ è½½å®æ—¶æ•°æ®
        async function loadLiveData() {
            try {
                // 1) ä»“ä½
                const posResp = await fetch(`/api/positions/${currentAccount}/${DEFAULT_POSITIONS_CURRENCY}`);
                const posData = await posResp.json();
                if (posData.success) {
                    livePositions = posData.positions || [];
                } else {
                    livePositions = [];
                }

                // 2) æœªæˆäº¤è®¢å•
                const ordersResp = await fetch(`/api/orders/open?accountName=${encodeURIComponent(currentAccount)}`);
                const ordersData = await ordersResp.json();
                if (ordersData.success) {
                    liveOrders = ordersData.orders || [];
                } else {
                    liveOrders = [];
                }
            } catch (error) {
                console.warn('åŠ è½½å®æ—¶æ•°æ®å¤±è´¥ï¼Œä½¿ç”¨ç©ºæ•°æ®:', error);
                livePositions = [];
                liveOrders = [];
            }
        }

        // åˆ·æ–°å®æ—¶æ•°æ®
        async function refreshLiveData() {
            if (!currentAccount) {
                showError('è¯·å…ˆé€‰æ‹©è´¦æˆ·');
                return;
            }

            try {
                await loadLiveData();
                await updatePositionsTable();
                updateOrdersTable();
                showSuccess('å®æ—¶æ•°æ®åˆ·æ–°æˆåŠŸ');
            } catch (error) {
                showError('åˆ·æ–°å®æ—¶æ•°æ®å¤±è´¥: ' + error.message);
            }
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats(recordsData, stats) {
            const positionRecords = deltaRecords.filter(r => r.record_type === 'position');
            const orderRecords = deltaRecords.filter(r => r.record_type === 'order');
            
            document.getElementById('totalRecords').textContent = deltaRecords.length;
            document.getElementById('positionRecords').textContent = positionRecords.length;
            document.getElementById('orderRecords').textContent = orderRecords.length;
            document.getElementById('accountSummary').textContent = stats ? 'å·²åŠ è½½' : 'æ— æ•°æ®';
        }

        // æ›´æ–°ä»“ä½è®°å½•è¡¨æ ¼
        async function updatePositionRecordsTable() {
            const tbody = document.querySelector('#positionRecordsTable tbody');
            tbody.innerHTML = '';

            const positionRecords = validatedRecords.filter(record => record.record_type === 'position');

            if (positionRecords.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="12" style="text-align: center; color: #7f8c8d;">æš‚æ— ä»“ä½è®°å½•</td>';
                tbody.appendChild(row);
                return;
            }

            // ä¸ºæ¯ä¸ªä»“ä½è®°å½•åˆ›å»ºè¡Œï¼Œå¹¶å¼‚æ­¥è·å–Deltaå€¼
            for (const [index, record] of positionRecords.entries()) {
                const row = document.createElement('tr');

                const targetDeltaClass = record.target_delta >= 0 ? 'delta-positive' : 'delta-negative';
                const movePositionDeltaClass = (record.move_position_delta || 0) >= 0 ? 'delta-positive' : 'delta-negative';

                // æ£€æŸ¥åŒæ­¥çŠ¶æ€ï¼šæ•°æ®åº“è®°å½•æ˜¯å¦åœ¨å®é™…ä»“ä½ä¸­å­˜åœ¨
                const livePosition = livePositions.find(position =>
                    position.instrument_name === record.instrument_name &&
                    Math.abs(position.size) > 0
                );
                const hasLivePosition = !!livePosition;

                const combinedStatus = hasLivePosition ?
                    '<span class="status-normal">ğŸŸ¢ æ­£å¸¸</span>' :
                    '<span class="status-abnormal">ğŸ”´ ä¸å­˜åœ¨</span>';

                // æ ¹æ®çŠ¶æ€å†³å®šæ•°é‡æ˜¾ç¤ºï¼šæ­£å¸¸çŠ¶æ€æ˜¾ç¤ºå®é™…ä»“ä½æ•°é‡ï¼Œå¦åˆ™æ˜¾ç¤ºæ•°æ®åº“è®°å½•æ•°é‡
                const displayAmount = hasLivePosition ?
                    livePosition.size :
                    (record.amount ?? '-');

                // æ ¹æ®çŠ¶æ€å†³å®šDeltaåˆ—çš„å†…å®¹
                const deltaContent = hasLivePosition ?
                    `<td class="delta-loading">
                        <div class="delta-cell-wrapper">
                            <span>ğŸ”„ è®¡ç®—ä¸­...</span>
                            <button class="btn-sm btn-refresh-delta" onclick="refreshSingleDelta('${record.instrument_name}', this)" title="åˆ·æ–°Delta">
                                ğŸ”„
                            </button>
                        </div>
                    </td>` :
                    '<td style="color: #7f8c8d;">-</td>';

                // æ ¹æ®çŠ¶æ€å†³å®šç›ˆäºç‡æ˜¾ç¤ºï¼šæ­£å¸¸çŠ¶æ€æ˜¾ç¤ºå®é™…ä»“ä½ç›ˆäºç‡ï¼Œå¦åˆ™æ˜¾ç¤º"-"
                let pnlPercentContent = '-';

                if (hasLivePosition) {
                    const pnlPercent = livePosition.pnl_percent;

                    if (pnlPercent !== null && pnlPercent !== undefined) {
                        const percentValue = pnlPercent * 100;
                        const absValue = Math.abs(percentValue);
                        const formattedValue = absValue >= 1 ? percentValue.toFixed(1) : percentValue.toFixed(2);
                        const signPrefix = percentValue > 0 ? '+' : '';

                        let pnlClass = 'pnl-neutral';
                        if (percentValue > 0.05) {
                            pnlClass = 'pnl-positive';
                        } else if (percentValue < -0.05) {
                            pnlClass = 'pnl-negative';
                        }

                        pnlPercentContent = `<span class="pnl-badge ${pnlClass}">${signPrefix}${formattedValue}%</span>`;
                    }
                }

                row.innerHTML = `
                    <td>${combinedStatus}</td>
                    <td>${record.instrument_name}</td>
                    <td>${displayAmount}</td>
                    <td class="${targetDeltaClass}">${record.target_delta.toFixed(4)}</td>
                    <td class="${movePositionDeltaClass}">${(record.move_position_delta || 0).toFixed(4)}</td>
                    ${deltaContent}
                    <td>${pnlPercentContent}</td>
                    <td>${record.min_expire_days || '-'}</td>
                    <td>${record.tv_id || '-'}</td>
                    <td>${record.action || '-'}</td>
                    <td>${new Date(record.created_at).toLocaleString()}</td>
                    <td>
                        <div class="btn-group">
                            <button class="btn-sm btn-view" onclick="viewRecord('${record.id}')">æŸ¥çœ‹</button>
                            <button class="btn-sm btn-edit" data-action="edit" data-record-id="${record.id}">ç¼–è¾‘</button>
                            <button class="btn-sm btn-delete" data-action="delete" data-record-id="${record.id}">åˆ é™¤</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);

                // åªæœ‰çŠ¶æ€ä¸º"æ­£å¸¸"æ—¶æ‰å¼‚æ­¥è·å–Deltaå€¼
                if (hasLivePosition) {
                    // æ·»åŠ å»¶è¿Ÿï¼Œé¿å…å¹¶å‘è°ƒç”¨æ¥å£è¿‡å¤š
                    const delay = index * 5000; // æ¯ä¸ªè¯·æ±‚é—´éš”5ç§’
                    setTimeout(() => {
                        fetchOptionDelta(record.instrument_name).then(calculatedDelta => {
                            const deltaCell = row.querySelector('.delta-loading');

                            if (calculatedDelta !== null) {
                                const deltaClass = calculatedDelta >= 0 ? 'delta-positive' : 'delta-negative';
                                const deltaText = calculatedDelta.toFixed(4);

                                deltaCell.className = deltaClass;
                                deltaCell.innerHTML = `
                                    <div class="delta-cell-wrapper">
                                        <span>${deltaText}</span>
                                        <button class="btn-sm btn-refresh-delta" onclick="refreshSingleDelta('${record.instrument_name}', this)" title="åˆ·æ–°Delta">
                                            ğŸ”„
                                        </button>
                                    </div>
                                `;
                            } else {
                                deltaCell.className = '';
                                deltaCell.innerHTML = `
                                    <div class="delta-cell-wrapper">
                                        <span>-</span>
                                        <button class="btn-sm btn-refresh-delta" onclick="refreshSingleDelta('${record.instrument_name}', this)" title="åˆ·æ–°Delta">
                                            ğŸ”„
                                        </button>
                                    </div>
                                `;
                            }
                        }).catch(error => {
                            console.error(`æ›´æ–° ${record.instrument_name} Deltaå¤±è´¥:`, error);
                            const deltaCell = row.querySelector('.delta-loading');
                            deltaCell.className = '';
                            deltaCell.innerHTML = `
                                <div class="delta-cell-wrapper">
                                    <span>âŒ å¤±è´¥</span>
                                    <button class="btn-sm btn-refresh-delta" onclick="refreshSingleDelta('${record.instrument_name}', this)" title="åˆ·æ–°Delta">
                                        ğŸ”„
                                    </button>
                                </div>
                            `;
                        });
                    }, delay);
                }
            }
        }

        // æ›´æ–°è®¢å•è®°å½•è¡¨æ ¼
        function updateOrderRecordsTable() {
            const tbody = document.querySelector('#orderRecordsTable tbody');
            tbody.innerHTML = '';

            const orderRecords = validatedRecords.filter(record => record.record_type === 'order');

            orderRecords.forEach(record => {
                const row = document.createElement('tr');

                const targetDeltaClass = record.target_delta >= 0 ? 'delta-positive' : 'delta-negative';
                const movePositionDeltaClass = (record.move_position_delta || 0) >= 0 ? 'delta-positive' : 'delta-negative';

                // æ£€æŸ¥åŒæ­¥çŠ¶æ€ï¼šæ•°æ®åº“è®°å½•æ˜¯å¦åœ¨å®é™…è®¢å•ä¸­å­˜åœ¨
                const hasLiveOrder = liveOrders.some(order =>
                    order.order_id === record.order_id ||
                    (order.instrument_name === record.instrument_name && order.order_state === 'open')
                );

                const combinedStatus = hasLiveOrder ?
                    '<span class="status-normal">ğŸŸ¢ æ­£å¸¸</span>' :
                    '<span class="status-abnormal">ğŸ”´ ä¸å­˜åœ¨</span>';

                row.innerHTML = `
                    <td>${combinedStatus}</td>
                    <td>${record.order_id || '-'}</td>
                    <td>${record.instrument_name}</td>
                    <td>${record.amount || '-'}</td>
                    <td class="${targetDeltaClass}">${record.target_delta.toFixed(4)}</td>
                    <td class="${movePositionDeltaClass}">${(record.move_position_delta || 0).toFixed(4)}</td>
                    <td>${record.min_expire_days || '-'}</td>
                    <td>${record.tv_id || '-'}</td>
                    <td>${record.action || '-'}</td>
                    <td>${new Date(record.updated_at || record.created_at).toLocaleString()}</td>
                    <td>
                        <div class="btn-group">
                            <button class="btn-sm btn-view" onclick="viewRecord('${record.id}')">æŸ¥çœ‹</button>
                            <button class="btn-sm btn-edit" data-action="edit" data-record-id="${record.id}">ç¼–è¾‘</button>
                            <button class="btn-sm btn-delete" data-action="delete" data-record-id="${record.id}">åˆ é™¤</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });

            if (orderRecords.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="11" style="text-align: center; color: #7f8c8d;">æš‚æ— è®¢å•è®°å½•</td>';
                tbody.appendChild(row);
            }
        }

        // è·å–æœŸæƒDeltaå€¼
        async function fetchOptionDelta(instrumentName) {
            try {
                const params = new URLSearchParams({
                    option_name: instrumentName
                });
                const response = await fetch(`/api/tiger/options/delta?${params}`);
                const data = await response.json();

                if (response.ok && data.success && data.delta !== null) {
                    return data.delta;
                }
                return null;
            } catch (error) {
                console.warn(`è·å– ${instrumentName} Deltaå¤±è´¥:`, error);
                return null;
            }
        }

        // åˆ·æ–°å•ä¸ªæœŸæƒçš„Deltaå€¼
        async function refreshSingleDelta(instrumentName, buttonElement) {
            // è·å–æŒ‰é’®æ‰€åœ¨çš„tdå…ƒç´ 
            const td = buttonElement.closest('td');
            const wrapper = td.querySelector('.delta-cell-wrapper');

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            wrapper.innerHTML = `
                <span>ğŸ”„ åˆ·æ–°ä¸­...</span>
                <button class="btn-sm btn-refresh-delta" onclick="refreshSingleDelta('${instrumentName}', this)" title="åˆ·æ–°Delta" disabled>
                    ğŸ”„
                </button>
            `;

            try {
                const calculatedDelta = await fetchOptionDelta(instrumentName);

                if (calculatedDelta !== null) {
                    const deltaClass = calculatedDelta >= 0 ? 'delta-positive' : 'delta-negative';
                    const deltaText = calculatedDelta.toFixed(4);

                    td.className = deltaClass;
                    wrapper.innerHTML = `
                        <span>${deltaText}</span>
                        <button class="btn-sm btn-refresh-delta" onclick="refreshSingleDelta('${instrumentName}', this)" title="åˆ·æ–°Delta">
                            ğŸ”„
                        </button>
                    `;
                } else {
                    td.className = '';
                    wrapper.innerHTML = `
                        <span>-</span>
                        <button class="btn-sm btn-refresh-delta" onclick="refreshSingleDelta('${instrumentName}', this)" title="åˆ·æ–°Delta">
                            ğŸ”„
                        </button>
                    `;
                }
            } catch (error) {
                console.error(`åˆ·æ–° ${instrumentName} Deltaå¤±è´¥:`, error);
                td.className = '';
                wrapper.innerHTML = `
                    <span>âŒ å¤±è´¥</span>
                    <button class="btn-sm btn-refresh-delta" onclick="refreshSingleDelta('${instrumentName}', this)" title="åˆ·æ–°Delta">
                        ğŸ”„
                    </button>
                `;
            }
        }

        // æ›´æ–°å®é™…ä»“ä½è¡¨æ ¼
        async function updatePositionsTable() {
            const tbody = document.querySelector('#positionsTable tbody');
            tbody.innerHTML = '';

            // è¿‡æ»¤å‡ºæœªè®°å½•åœ¨æ•°æ®åº“ä¸­çš„ä»“ä½
            const unrecordedPositions = livePositions.filter(position => {
                return !deltaRecords.some(record =>
                    record.record_type === 'position' &&
                    record.instrument_name === position.instrument_name
                );
            });

            if (unrecordedPositions.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="7" style="text-align: center; color: #7f8c8d;">æ‰€æœ‰ä»“ä½éƒ½å·²è®°å½•åœ¨æ•°æ®åº“ä¸­</td>';
                tbody.appendChild(row);
                return;
            }

            // ä¸ºæ¯ä¸ªä»“ä½åˆ›å»ºè¡Œï¼Œå¹¶å¼‚æ­¥è·å–Deltaå€¼
            for (const [index, position] of unrecordedPositions.entries()) {
                const row = document.createElement('tr');
                const direction = position.size > 0 ? 'å¤šå¤´' : 'ç©ºå¤´';
                const directionClass = position.size > 0 ? 'action-buy' : 'action-sell';

                // å…ˆåˆ›å»ºè¡Œï¼ŒDeltaåˆ—æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                row.innerHTML = `
                    <td>${position.instrument_name}</td>
                    <td>${Math.abs(position.size)}</td>
                    <td><span class="action-badge ${directionClass}">${direction}</span></td>
                    <td>${position.average_price ? position.average_price.toFixed(4) : '-'}</td>
                    <td>${position.mark_price ? position.mark_price.toFixed(4) : '-'}</td>
                    <td class="delta-loading">
                        <div class="delta-cell-wrapper">
                            <span>ğŸ”„ è®¡ç®—ä¸­...</span>
                            <button class="btn-sm btn-refresh-delta" onclick="refreshSingleDelta('${position.instrument_name}', this)" title="åˆ·æ–°Delta">
                                ğŸ”„
                            </button>
                        </div>
                    </td>
                    <td>
                        <button class="btn-sm btn-add" data-action="add-position" data-instrument="${position.instrument_name}">
                            â• æ·»åŠ åˆ°æ•°æ®åº“
                        </button>
                    </td>
                `;
                tbody.appendChild(row);

                // å¼‚æ­¥è·å–Deltaå€¼å¹¶æ›´æ–°
                // æ·»åŠ å»¶è¿Ÿï¼Œé¿å…å¹¶å‘è°ƒç”¨æ¥å£è¿‡å¤š
                const delay = index * 5000; // æ¯ä¸ªè¯·æ±‚é—´éš”5ç§’
                setTimeout(() => {
                    fetchOptionDelta(position.instrument_name).then(calculatedDelta => {
                        const deltaCell = row.querySelector('.delta-loading');

                        if (calculatedDelta !== null) {
                            const deltaClass = calculatedDelta >= 0 ? 'delta-positive' : 'delta-negative';
                            const deltaText = calculatedDelta.toFixed(4);

                            deltaCell.className = deltaClass;
                            deltaCell.innerHTML = `
                                <div class="delta-cell-wrapper">
                                    <span>${deltaText}</span>
                                    <button class="btn-sm btn-refresh-delta" onclick="refreshSingleDelta('${position.instrument_name}', this)" title="åˆ·æ–°Delta">
                                        ğŸ”„
                                    </button>
                                </div>
                            `;
                        } else {
                            // å¦‚æœAPIè®¡ç®—å¤±è´¥ï¼Œå›é€€åˆ°åŸå§‹deltaå€¼
                            const fallbackDelta = position.delta;
                            if (fallbackDelta !== null && fallbackDelta !== undefined) {
                                const deltaClass = fallbackDelta >= 0 ? 'delta-positive' : 'delta-negative';
                                const deltaText = fallbackDelta.toFixed(4);

                                deltaCell.className = deltaClass;
                                deltaCell.innerHTML = `
                                    <div class="delta-cell-wrapper">
                                        <span>${deltaText}</span>
                                        <button class="btn-sm btn-refresh-delta" onclick="refreshSingleDelta('${position.instrument_name}', this)" title="åˆ·æ–°Delta">
                                            ğŸ”„
                                        </button>
                                    </div>
                                `;
                            } else {
                                deltaCell.className = '';
                                deltaCell.innerHTML = `
                                    <div class="delta-cell-wrapper">
                                        <span>-</span>
                                        <button class="btn-sm btn-refresh-delta" onclick="refreshSingleDelta('${position.instrument_name}', this)" title="åˆ·æ–°Delta">
                                            ğŸ”„
                                        </button>
                                    </div>
                                `;
                            }
                        }
                    }).catch(error => {
                        console.error(`æ›´æ–° ${position.instrument_name} Deltaå¤±è´¥:`, error);
                        const deltaCell = row.querySelector('.delta-loading');
                        deltaCell.className = '';
                        deltaCell.innerHTML = `
                            <div class="delta-cell-wrapper">
                                <span>âŒ å¤±è´¥</span>
                                <button class="btn-sm btn-refresh-delta" onclick="refreshSingleDelta('${position.instrument_name}', this)" title="åˆ·æ–°Delta">
                                    ğŸ”„
                                </button>
                            </div>
                        `;
                    });
                }, delay);
            }
        }

        // æ›´æ–°æœªæˆäº¤è®¢å•è¡¨æ ¼
        function updateOrdersTable() {
            const tbody = document.querySelector('#ordersTable tbody');
            tbody.innerHTML = '';

            // è¿‡æ»¤å‡ºæœªè®°å½•åœ¨æ•°æ®åº“ä¸­çš„è®¢å•
            const unrecordedOrders = liveOrders.filter(order => {
                return !deltaRecords.some(record =>
                    record.record_type === 'order' &&
                    record.order_id === order.order_id
                );
            });

            unrecordedOrders.forEach(order => {
                const row = document.createElement('tr');

                const direction = order.direction === 'buy' ? 'ä¹°å…¥' : 'å–å‡º';
                const directionClass = order.direction === 'buy' ? 'action-buy' : 'action-sell';

                row.innerHTML = `
                    <td>${order.order_id}</td>
                    <td>${order.instrument_name}</td>
                    <td><span class="action-badge ${directionClass}">${direction}</span></td>
                    <td>${order.amount}</td>
                    <td>${order.price ? order.price.toFixed(4) : '-'}</td>
                    <td>${order.order_type || 'limit'}</td>
                    <td>
                        <button class="btn-sm btn-add" data-action="add-order" data-order-id="${order.order_id}" data-instrument="${order.instrument_name}">
                            â• æ·»åŠ åˆ°æ•°æ®åº“
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            if (unrecordedOrders.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="7" style="text-align: center; color: #7f8c8d;">æš‚æ— æœªè®°å½•çš„è®¢å•</td>';
                tbody.appendChild(row);
            }
        }

        // åˆ·æ–°æ•°æ®
        function refreshData() {
            if (currentAccount) {
                loadData();
            }
        }

        // å¤åˆ¶è­¦æŠ¥æ¶ˆæ¯
        function copyAlertMessage() {
            const accountId = document.getElementById('accountSelect').value;
            if (!accountId) {
                showError('è¯·å…ˆé€‰æ‹©è´¦æˆ·');
                return;
            }

            // ç”ŸæˆéšæœºTV_ID
            const tvId = Math.floor(Math.random() * 9999999999) + 1000000000;

            // ç”ŸæˆTradingViewè­¦æŠ¥æ¶ˆæ¯æ ¼å¼ï¼ˆåŒ¹é…åŸå§‹TypeScriptç‰ˆæœ¬ï¼‰
            const alertMessage = `{
  "accountName": "${accountId}",
  "symbol": "{{ticker}}",
  "side": "{{strategy.order.action}}",
  "exchange": "{{exchange}}",
  "period": "{{interval}}",
  "size": {{plot("size")}},
  "price": "{{close}}",
  "marketPosition": "{{strategy.market_position}}",
  "prevMarketPosition": "{{strategy.prev_market_position}}",
  "qtyType": "cash",
  "delta1": {{plot("delta1")}},
  "n": {{plot("n")}},
  "delta2": {{plot("delta2")}},
  "timestamp": "{{timenow}}",
  "alertMessage": "{{strategy.order.alert_message}}",
  "comment": "{{strategy.order.comment}}",
  "tv_id": ${tvId}
}`;

            // æ˜¾ç¤ºå¼¹çª—
            showAlertMessageModal(alertMessage);
        }

        // æ˜¾ç¤ºè­¦æŠ¥æ¶ˆæ¯å¼¹çª—
        function showAlertMessageModal(alertMessage) {
            // åˆ›å»ºå¼¹çª—HTML
            const modalHtml = `
                <div class="modal-overlay" id="alertMessageModal" onclick="closeAlertMessageModal()">
                    <div class="modal-content" onclick="event.stopPropagation()" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
                        <div class="modal-header">
                            <h3>ğŸ“‹ TradingView è­¦æŠ¥æ¶ˆæ¯æ¨¡æ¿</h3>
                            <button class="modal-close" onclick="closeAlertMessageModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <p>å¤åˆ¶ä»¥ä¸‹JSONæ¶ˆæ¯æ¨¡æ¿åˆ°TradingViewè­¦æŠ¥ä¸­ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ›¿æ¢ç›¸åº”çš„å˜é‡ï¼š</p>

                            <div style="position: relative; margin: 15px 0;">
                                <button class="btn btn-primary" onclick="copyToClipboard()" style="position: absolute; top: 10px; right: 10px; z-index: 10;">å¤åˆ¶</button>
                                <textarea id="alertMessageText" readonly style="width: 100%; height: 300px; font-family: monospace; font-size: 12px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background: #f8f9fa;">${alertMessage}</textarea>
                            </div>

                            <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px; padding: 15px; margin: 15px 0;">
                                <h4 style="margin: 0 0 10px 0; color: #856404;">âš ï¸ é‡è¦æé†’ï¼šå“ç§é€‰æ‹©æ³¨æ„äº‹é¡¹</h4>
                                <div style="margin-bottom: 10px;">
                                    <p style="margin: 5px 0;">â€¢ <strong>xxUSDCå“ç§</strong>ï¼šç”¨æ¥äº¤æ˜“USDCæœŸæƒï¼ˆç°é‡‘ç»“ç®—ï¼‰</p>
                                    <p style="margin: 5px 0;">â€¢ <strong>xxUSDTå“ç§</strong>ï¼šç”¨æ¥äº¤æ˜“å¸æœ¬ä½æœŸæƒï¼ˆå®ç‰©ç»“ç®—ï¼‰</p>
                                </div>
                                <p style="margin: 5px 0; font-size: 14px;">è¯·æ ¹æ®æ‚¨çš„äº¤æ˜“éœ€æ±‚é€‰æ‹©æ­£ç¡®çš„å“ç§ï¼Œé¿å…å› å“ç§é€‰æ‹©é”™è¯¯å¯¼è‡´çš„äº¤æ˜“é—®é¢˜ã€‚</p>
                            </div>

                            <div style="background: #e7f3ff; border: 1px solid #b3d9ff; border-radius: 5px; padding: 15px; margin: 15px 0;">
                                <h4 style="margin: 0 0 10px 0; color: #0056b3;">ğŸ“ ä½¿ç”¨è¯´æ˜ï¼š</h4>
                                <ul style="margin: 0; padding-left: 20px;">
                                    <li><strong>accountName</strong>: è‡ªåŠ¨ä½¿ç”¨å½“å‰é€‰ä¸­çš„è´¦æˆ·</li>
                                    <li><strong>tv_id</strong>: è‡ªåŠ¨ç”Ÿæˆéšæœºæ•´æ•°ID</li>
                                    <li><strong>{{ticker}}</strong>: TradingViewä¼šæ›¿æ¢ä¸ºå½“å‰äº¤æ˜“å¯¹</li>
                                    <li><strong>{{strategy.order.action}}</strong>: TradingViewä¼šæ›¿æ¢ä¸ºç­–ç•¥åŠ¨ä½œ</li>
                                    <li><strong>{{plot("size")}}</strong>: TradingViewä¼šæ›¿æ¢ä¸ºè‡ªå®šä¹‰sizeå€¼</li>
                                    <li><strong>{{close}}</strong>: TradingViewä¼šæ›¿æ¢ä¸ºå½“å‰æ”¶ç›˜ä»·</li>
                                    <li>å…¶ä»–å˜é‡ä¼šè¢«TradingViewè‡ªåŠ¨æ›¿æ¢ä¸ºç›¸åº”çš„å€¼</li>
                                </ul>
                            </div>

                            <div class="modal-actions">
                                <button class="btn btn-primary" onclick="copyToClipboard()">ğŸ“‹ å¤åˆ¶åˆ°å‰ªè´´æ¿</button>
                                <button class="btn btn-secondary" onclick="closeAlertMessageModal()">å…³é—­</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // æ·»åŠ åˆ°é¡µé¢
            document.body.insertAdjacentHTML('beforeend', modalHtml);

            // é€‰ä¸­æ–‡æœ¬
            const textarea = document.getElementById('alertMessageText');
            textarea.select();
        }

        // å…³é—­è­¦æŠ¥æ¶ˆæ¯å¼¹çª—
        function closeAlertMessageModal() {
            const modal = document.getElementById('alertMessageModal');
            if (modal) {
                modal.remove();
            }
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard() {
            const textarea = document.getElementById('alertMessageText');
            const text = textarea.value;

            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(() => {
                    showSuccess('è­¦æŠ¥æ¶ˆæ¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                    closeAlertMessageModal();
                }).catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    fallbackCopyTextToClipboard(text);
                });
            } else {
                fallbackCopyTextToClipboard(text);
            }
        }

        // é™çº§å¤åˆ¶æ–¹æ¡ˆ
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;

            textArea.style.top = "0";
            textArea.style.left = "0";
            textArea.style.position = "fixed";

            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showSuccess('è­¦æŠ¥æ¶ˆæ¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                    closeAlertMessageModal();
                } else {
                    showError('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                }
            } catch (err) {
                console.error('Fallback: å¤åˆ¶å¤±è´¥', err);
                showError('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            }

            document.body.removeChild(textArea);
        }

        // æŸ¥çœ‹è®°å½•è¯¦æƒ…
        function viewRecord(recordId) {
            const record = deltaRecords.find(r => r.id == recordId);
            if (record) {
                alert(`è®°å½•è¯¦æƒ…:\n${JSON.stringify(record, null, 2)}`);
            }
        }

        // æ·»åŠ ä»“ä½åˆ°æ•°æ®åº“ - ç¡®ä¿åœ¨å…¨å±€ä½œç”¨åŸŸ
        window.addPositionToDatabase = function(instrumentName) {
            try {
                showQuickAddModal(instrumentName, 'position');
            } catch (error) {
                console.error('âŒ addPositionToDatabase é”™è¯¯:', error);
                alert('æ·»åŠ ä»“ä½å¤±è´¥: ' + error.message);
            }
        };

        // æ·»åŠ è®¢å•åˆ°æ•°æ®åº“ - ç¡®ä¿åœ¨å…¨å±€ä½œç”¨åŸŸ
        window.addOrderToDatabase = function(orderId, instrumentName) {
            console.log('ğŸ¯ addOrderToDatabase è¢«è°ƒç”¨:', orderId, instrumentName);
            try {
                showQuickAddModal(instrumentName, 'order', orderId);
            } catch (error) {
                console.error('âŒ addOrderToDatabase é”™è¯¯:', error);
                alert('æ·»åŠ è®¢å•å¤±è´¥: ' + error.message);
            }
        };

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(message = 'æ­£åœ¨åŠ è½½æ•°æ®...') {
            document.getElementById('loadingMessage').innerHTML = `<h3>ğŸ”„ ${message}</h3>`;
            document.getElementById('loadingMessage').style.display = 'block';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
        }

        // éšè—åŠ è½½çŠ¶æ€
        function hideLoading() {
            document.getElementById('loadingMessage').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorMessage').style.display = 'block';
            document.getElementById('successMessage').style.display = 'none';
            setTimeout(() => {
                document.getElementById('errorMessage').style.display = 'none';
            }, 5000);
        }

        // æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
        function showSuccess(message) {
            document.getElementById('successMessage').textContent = message;
            document.getElementById('successMessage').style.display = 'block';
            document.getElementById('errorMessage').style.display = 'none';
            setTimeout(() => {
                document.getElementById('successMessage').style.display = 'none';
            }, 3000);
        }

        // ç¼–è¾‘è®°å½•
        function editRecord(recordId) {
            const record = validatedRecords.find(r => r.id === recordId);
            if (!record) {
                showError('è®°å½•ä¸å­˜åœ¨');
                return;
            }

            editingRecordId = recordId;
            document.getElementById('editModalTitle').textContent = 'ç¼–è¾‘Deltaè®°å½•';
            document.getElementById('editInstrumentName').value = record.instrument_name;
            document.getElementById('editTargetDeltaValue').value = record.target_delta;
            document.getElementById('editMovePositionDeltaValue').value = record.move_position_delta || 0;
            document.getElementById('editMinExpireDays').value = record.min_expire_days || '';
            document.getElementById('editTvId').value = record.tv_id || '';

            if (record.record_type === 'order') {
                document.getElementById('editOrderIdGroup').style.display = 'block';
                document.getElementById('editOrderId').value = record.order_id || '';
            } else {
                document.getElementById('editOrderIdGroup').style.display = 'none';
            }

            document.getElementById('editModal').style.display = 'block';
        }

        // åˆ é™¤è®°å½•
        async function deleteRecord(recordId) {
            const record = validatedRecords.find(r => r.id === recordId);
            if (!record) {
                showError('è®°å½•ä¸å­˜åœ¨');
                return;
            }

            const confirmMessage = `ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ\n\n` +
                `åˆçº¦: ${record.instrument_name}\n` +
                `ç›®æ ‡Delta: ${record.target_delta}\n` +
                `ç§»ä»“Delta: ${record.move_position_delta || 0}\n` +
                `ç±»å‹: ${record.record_type === 'position' ? 'ä»“ä½' : 'è®¢å•'}\n` +
                `TV_ID: ${record.tv_id || 'æ— '}\n` +
                `åˆ›å»ºæ—¶é—´: ${new Date(record.created_at).toLocaleString()}`;

            if (!confirm(confirmMessage)) return;

            try {
                console.log('ğŸ—‘ï¸ åˆ é™¤è®°å½•:', recordId);

                const response = await fetch(`/api/delta/records/${recordId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.message);
                }

                showSuccess(`è®°å½•åˆ é™¤æˆåŠŸ (${record.instrument_name})`);
                loadData();

            } catch (error) {
                console.error('âŒ åˆ é™¤è®°å½•å¤±è´¥:', error);
                showError('åˆ é™¤å¤±è´¥: ' + error.message);
            }
        }

        // å…³é—­ç¼–è¾‘æ¨¡æ€æ¡†
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            editingRecordId = null;
        }

        // å…¨å±€å˜é‡
        let editingRecordId = null;

        // äº‹ä»¶å§”æ‰˜å¤„ç†å™¨
        document.addEventListener('click', function(e) {
            const target = e.target;
            const action = target.getAttribute('data-action');

            if (!action) return;

            console.log('ğŸ¯ æ£€æµ‹åˆ°æŒ‰é’®ç‚¹å‡»:', action);

            try {
                switch (action) {
                    case 'edit':
                        const recordId = target.getAttribute('data-record-id');
                        editRecord(parseInt(recordId));
                        break;

                    case 'delete':
                        const deleteRecordId = target.getAttribute('data-record-id');
                        deleteRecord(parseInt(deleteRecordId));
                        break;

                    case 'close-edit':
                        closeEditModal();
                        break;

                    case 'close-quick-add':
                        closeQuickAddModal();
                        break;

                    case 'add-position':
                        const instrumentName = target.getAttribute('data-instrument');
                        addPositionToDatabase(instrumentName);
                        break;

                    case 'add-order':
                        const orderId = target.getAttribute('data-order-id');
                        const orderInstrument = target.getAttribute('data-instrument');
                        addOrderToDatabase(orderId, orderInstrument);
                        break;

                    default:
                        console.log('âš ï¸ æœªçŸ¥çš„æ“ä½œ:', action);
                }
            } catch (error) {
                console.error('âŒ æ‰§è¡Œæ“ä½œå¤±è´¥:', error);
                showError('æ“ä½œå¤±è´¥: ' + error.message);
            }
        });

        // ç¼–è¾‘è¡¨å•æäº¤å¤„ç†
        document.addEventListener('DOMContentLoaded', function() {
            const editForm = document.getElementById('editForm');
            if (editForm) {
                editForm.addEventListener('submit', async function(e) {
                    e.preventDefault();

                    if (!editingRecordId) {
                        showError('æ²¡æœ‰é€‰æ‹©è¦ç¼–è¾‘çš„è®°å½•');
                        return;
                    }

                    const formData = {
                        target_delta: parseFloat(document.getElementById('editTargetDeltaValue').value),
                        move_position_delta: parseFloat(document.getElementById('editMovePositionDeltaValue').value),
                        min_expire_days: document.getElementById('editMinExpireDays').value ?
                            parseInt(document.getElementById('editMinExpireDays').value) : null,
                        tv_id: document.getElementById('editTvId').value ?
                            parseInt(document.getElementById('editTvId').value) : null
                    };

                    try {
                        const response = await fetch(`/api/delta/records/${editingRecordId}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(formData)
                        });

                        const result = await response.json();

                        if (!result.success) {
                            throw new Error(result.message);
                        }

                        closeEditModal();
                        showSuccess('è®°å½•æ›´æ–°æˆåŠŸ');
                        loadData();

                    } catch (error) {
                        console.error('âŒ æ›´æ–°è®°å½•å¤±è´¥:', error);
                        showError('æ›´æ–°å¤±è´¥: ' + error.message);
                    }
                });
            }

            // å¿«é€Ÿæ·»åŠ è¡¨å•æäº¤å¤„ç†
            const quickAddForm = document.getElementById('quickAddForm');
            if (quickAddForm) {
                quickAddForm.addEventListener('submit', async function(e) {
                    e.preventDefault();

                    if (!window.currentQuickAdd) return;

                    const targetDeltaInput = document.getElementById('quickTargetDeltaValue').value;
                    const movePositionDeltaInput = document.getElementById('quickMovePositionDeltaValue').value;
                    const tvIdInput = document.getElementById('quickTvId').value;
                    const minExpireDaysInput = document.getElementById('quickMinExpireDays').value;

                    // éªŒè¯å¿…å¡«å­—æ®µ
                    if (!targetDeltaInput.trim()) {
                        showError('è¯·è¾“å…¥ç›®æ ‡Delta(2)å€¼');
                        return;
                    }

                    if (!movePositionDeltaInput.trim()) {
                        showError('è¯·è¾“å…¥ç§»ä»“Deltaå€¼');
                        return;
                    }

                    const targetDeltaValue = parseFloat(targetDeltaInput);
                    const movePositionDeltaValue = parseFloat(movePositionDeltaInput);

                    if (isNaN(targetDeltaValue) || targetDeltaValue < -1 || targetDeltaValue > 1) {
                        showError('ç›®æ ‡Delta(2)å€¼å¿…é¡»åœ¨-1åˆ°1ä¹‹é—´');
                        return;
                    }

                    if (isNaN(movePositionDeltaValue) || movePositionDeltaValue < -1 || movePositionDeltaValue > 1) {
                        showError('ç§»ä»“Deltaå€¼å¿…é¡»åœ¨-1åˆ°1ä¹‹é—´');
                        return;
                    }

                    let minExpireDaysValue = null;
                    if (minExpireDaysInput.trim()) {
                        minExpireDaysValue = parseInt(minExpireDaysInput);
                        if (isNaN(minExpireDaysValue) || minExpireDaysValue <= 0) {
                            showError('æœ€å°åˆ°æœŸå¤©æ•°å¿…é¡»æ˜¯å¤§äº0çš„æ•´æ•°');
                            return;
                        }
                    }

                    const tvId = tvIdInput.trim() ? parseInt(tvIdInput) : null;

                    const formData = {
                        account_id: currentAccount,
                        instrument_name: window.currentQuickAdd.instrumentName,
                        target_delta: targetDeltaValue,
                        move_position_delta: movePositionDeltaValue,
                        min_expire_days: minExpireDaysValue,
                        tv_id: tvId,
                        record_type: window.currentQuickAdd.recordType
                    };

                    if (window.currentQuickAdd.orderId) {
                        formData.order_id = window.currentQuickAdd.orderId;
                    }

                    try {
                        const response = await fetch('/api/delta/records', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(formData)
                        });

                        const result = await response.json();

                        if (!result.success) {
                            throw new Error(result.message);
                        }

                        const recordTypeText = window.currentQuickAdd.recordType === 'position' ? 'ä»“ä½' : 'è®¢å•';
                        closeQuickAddModal();
                        showSuccess(`${recordTypeText}å·²æ·»åŠ åˆ°æ•°æ®åº“ (ç›®æ ‡Delta: ${targetDeltaValue}, ç§»ä»“Delta: ${movePositionDeltaValue}, TV_ID: ${tvId})`);
                        loadData();

                    } catch (error) {
                        showError('æ·»åŠ å¤±è´¥: ' + error.message);
                    }
                });
            }
        });

        // æ˜¾ç¤ºå¿«é€Ÿæ·»åŠ æ¨¡æ€æ¡† - ç¡®ä¿åœ¨å…¨å±€ä½œç”¨åŸŸ
        window.showQuickAddModal = function(instrumentName, recordType, orderId = null) {
            console.log('ğŸ”„ showQuickAddModal è¢«è°ƒç”¨:', instrumentName, recordType, orderId);

            try {
                document.getElementById('quickInstrumentName').value = instrumentName;
                document.getElementById('quickTargetDeltaValue').value = '';
                document.getElementById('quickMovePositionDeltaValue').value = '';
                document.getElementById('quickMinExpireDays').value = '';
                document.getElementById('quickTvId').value = '';

                const quickOrderIdGroup = document.getElementById('quickOrderIdGroup');
                const quickTargetDeltaGroup = document.getElementById('quickTargetDeltaGroup');
                const quickMovePositionDeltaGroup = document.getElementById('quickMovePositionDeltaGroup');
                const quickTargetDeltaInput = document.getElementById('quickTargetDeltaValue');
                const quickMovePositionDeltaInput = document.getElementById('quickMovePositionDeltaValue');

                if (recordType === 'order') {
                    // è®¢å•è®°å½•ï¼šæ˜¾ç¤ºè®¢å•IDï¼Œæ˜¾ç¤ºç›®æ ‡Deltaå­—æ®µå’Œç§»ä»“Deltaå­—æ®µ
                    quickOrderIdGroup.style.display = 'block';
                    quickTargetDeltaGroup.style.display = 'block';
                    quickMovePositionDeltaGroup.style.display = 'block';
                    document.getElementById('quickOrderId').value = orderId || '';
                    quickTargetDeltaInput.value = ''; // è®¢å•ç›®æ ‡Deltaä¹Ÿéœ€è¦ç”¨æˆ·è¾“å…¥
                    quickMovePositionDeltaInput.value = ''; // è®¢å•ç§»ä»“Deltaä¹Ÿéœ€è¦ç”¨æˆ·è¾“å…¥
                    quickTargetDeltaInput.required = true;
                    quickMovePositionDeltaInput.required = true;

                    document.getElementById('quickAddTitle').textContent = 'æ·»åŠ è®¢å•åˆ°æ•°æ®åº“';
                } else {
                    // ä»“ä½è®°å½•ï¼šéšè—è®¢å•IDï¼Œæ˜¾ç¤ºç›®æ ‡Deltaå­—æ®µå’Œç§»ä»“Deltaå­—æ®µ
                    quickOrderIdGroup.style.display = 'none';
                    quickTargetDeltaGroup.style.display = 'block';
                    quickMovePositionDeltaGroup.style.display = 'block';
                    quickTargetDeltaInput.required = true;
                    quickMovePositionDeltaInput.required = true;

                    document.getElementById('quickAddTitle').textContent = 'æ·»åŠ ä»“ä½åˆ°æ•°æ®åº“';
                }

                // å­˜å‚¨å½“å‰æ“ä½œä¿¡æ¯
                window.currentQuickAdd = {
                    instrumentName: instrumentName,
                    recordType: recordType,
                    orderId: orderId
                };

                document.getElementById('quickAddModal').style.display = 'block';

            } catch (error) {
                console.error('âŒ showQuickAddModal é”™è¯¯:', error);
                alert('æ˜¾ç¤ºæ·»åŠ ç•Œé¢å¤±è´¥: ' + error.message);
            }
        };

        // å…³é—­å¿«é€Ÿæ·»åŠ æ¨¡æ€æ¡†
        function closeQuickAddModal() {
            document.getElementById('quickAddModal').style.display = 'none';
            window.currentQuickAdd = null;
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const editModal = document.getElementById('editModal');
            const quickAddModal = document.getElementById('quickAddModal');

            if (event.target === editModal) {
                closeEditModal();
            } else if (event.target === quickAddModal) {
                closeQuickAddModal();
            }
        };
    </script>

    <!-- å¿«é€Ÿæ·»åŠ æ¨¡æ€æ¡† -->
    <div id="quickAddModal" class="modal">
        <div class="modal-content">
            <span class="close" data-action="close-quick-add">&times;</span>
            <h2 id="quickAddTitle">æ·»åŠ åˆ°æ•°æ®åº“</h2>
            <form id="quickAddForm">
                <div class="form-group">
                    <label for="quickInstrumentName">åˆçº¦åç§°:</label>
                    <input type="text" id="quickInstrumentName" readonly style="background: #f5f5f5;">
                </div>
                <div class="form-group" id="quickTargetDeltaGroup">
                    <label for="quickTargetDeltaValue">ç›®æ ‡Deltaå€¼ <span style="color: red;">*</span>:</label>
                    <input type="number" id="quickTargetDeltaValue" step="0.0001" min="-1" max="1" placeholder="è¯·è¾“å…¥ç›®æ ‡Deltaå€¼ (-1åˆ°1ä¹‹é—´)" required>
                    <small style="color: #666; font-size: 12px;">ä»“ä½å’Œè®¢å•éƒ½éœ€è¦è®¾ç½®ç›®æ ‡Deltaå€¼</small>
                </div>
                <div class="form-group" id="quickMovePositionDeltaGroup">
                    <label for="quickMovePositionDeltaValue">ç§»ä»“Deltaå€¼ <span style="color: red;">*</span>:</label>
                    <input type="number" id="quickMovePositionDeltaValue" step="0.0001" min="-1" max="1" placeholder="è¯·è¾“å…¥ç§»ä»“Deltaå€¼ (-1åˆ°1ä¹‹é—´)" required>
                    <small style="color: #666; font-size: 12px;">ä»“ä½å’Œè®¢å•éƒ½éœ€è¦è®¾ç½®ç§»ä»“Deltaå€¼</small>
                </div>
                <div class="form-group">
                    <label for="quickMinExpireDays">æœ€å°åˆ°æœŸå¤©æ•° (å¯ç•™ç©º):</label>
                    <input type="number" id="quickMinExpireDays" min="1" step="1" placeholder="è¯·è¾“å…¥æœ€å°åˆ°æœŸå¤©æ•° (å¤§äº0çš„æ•´æ•°ï¼Œå¯ç•™ç©º)">
                    <small style="color: #666; font-size: 12px;">ç”¨äºæœŸæƒé€‰æ‹©çš„æœ€å°åˆ°æœŸå¤©æ•°ï¼Œç•™ç©ºè¡¨ç¤ºä¸é™åˆ¶</small>
                </div>
                <div class="form-group">
                    <label for="quickTvId">TV_ID (å¯ç•™ç©º):</label>
                    <input type="number" id="quickTvId" placeholder="å¯é€‰çš„TradingViewä¿¡å·ID">
                </div>
                <div class="form-group" id="quickOrderIdGroup" style="display: none;">
                    <label for="quickOrderId">è®¢å•ID:</label>
                    <input type="text" id="quickOrderId" readonly style="background: #f5f5f5;">
                </div>
                <div style="text-align: right; margin-top: 30px;">
                    <button type="button" class="btn btn-danger" data-action="close-quick-add">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-success">æ·»åŠ åˆ°æ•°æ®åº“</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ç¼–è¾‘è®°å½•æ¨¡æ€æ¡† -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" data-action="close-edit">&times;</span>
            <h2 id="editModalTitle">ç¼–è¾‘è®°å½•</h2>
            <form id="editForm">
                <div class="form-group">
                    <label for="editInstrumentName">åˆçº¦åç§°:</label>
                    <input type="text" id="editInstrumentName" readonly style="background: #f5f5f5;">
                </div>
                <div class="form-group" id="editTargetDeltaGroup">
                    <label for="editTargetDeltaValue">ç›®æ ‡Deltaå€¼:</label>
                    <input type="number" id="editTargetDeltaValue" step="0.0001" min="-1" max="1" required>
                </div>
                <div class="form-group" id="editMovePositionDeltaGroup">
                    <label for="editMovePositionDeltaValue">ç§»ä»“Deltaå€¼:</label>
                    <input type="number" id="editMovePositionDeltaValue" step="0.0001" min="-1" max="1" required>
                </div>
                <div class="form-group">
                    <label for="editMinExpireDays">æœ€å°åˆ°æœŸå¤©æ•° (å¯ç•™ç©º):</label>
                    <input type="number" id="editMinExpireDays" min="1" step="1" placeholder="ç•™ç©ºè¡¨ç¤ºä¸é™åˆ¶">
                </div>
                <div class="form-group">
                    <label for="editTvId">TV_ID (å¯ç•™ç©º):</label>
                    <input type="number" id="editTvId" placeholder="å¯é€‰çš„TradingViewä¿¡å·ID">
                </div>
                <div class="form-group" id="editOrderIdGroup" style="display: none;">
                    <label for="editOrderId">è®¢å•ID:</label>
                    <input type="text" id="editOrderId" readonly style="background: #f5f5f5;">
                </div>
                <div style="text-align: right; margin-top: 30px;">
                    <button type="button" class="btn btn-danger" data-action="close-edit">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-success">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2024 Deribit Webhook Python - Delta Manager. Built with FastAPI and Python.</p>
        <p>
            <a href="/" target="_blank">è¿”å›é¦–é¡µ</a> |
            <a href="/docs" target="_blank">APIæ–‡æ¡£</a> |
            <a href="/redoc" target="_blank">ReDoc</a>
        </p>
    </footer>

    <!-- åˆ·æ–°æŒ‰é’® -->
    <button class="refresh-btn" onclick="refreshData()" title="åˆ·æ–°æ‰€æœ‰æ•°æ®">
        ğŸ”„
    </button>
    </div>
</body>
</html>
